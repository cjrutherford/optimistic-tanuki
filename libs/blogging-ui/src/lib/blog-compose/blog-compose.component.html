<otui-card
  class="compose-card"
  [class.dragover]="isDragOver"
  (dragenter)="handleDragEnter($event)"
  (dragover)="handleDragOver($event)"
  (dragleave)="handleDragLeave($event)"
  (drop)="handleDrop($event)"
  [variantOverrides]="{ background: backgroundGradient }"
  >
  <form>
    <label for="title">Title</label>
    <lib-text-input
      id="title"
      [type]="'text'"
      [(ngModel)]="title"
      [ngModelOptions]="{ standalone: true }"
      placeholder="Enter title"
    ></lib-text-input>

    <label for="content">Content</label>
    @if (editor) {
      <div class="tiptap-toolbar">
        <button
          type="button"
          (click)="editor.chain().focus().toggleBold().run()"
          [class.is-active]="editor.isActive('bold')"
          >
          <div>format_bold</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleItalic().run()"
          [class.is-active]="editor.isActive('italic')"
          >
          <div>format_italic</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleUnderline().run()"
          [class.is-active]="editor.isActive('underline')"
          >
          <div>format_underline</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleStrike().run()"
          [class.is-active]="editor.isActive('strike')"
          >
          <div>format_strikethrough</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleHeading({ level: 1 }).run()"
          [class.is-active]="editor.isActive('heading', { level: 1 })"
          >
          H1
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleHeading({ level: 2 }).run()"
          [class.is-active]="editor.isActive('heading', { level: 2 })"
          >
          H2
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleBulletList().run()"
          [class.is-active]="editor.isActive('bulletList')"
          >
          <div>format_list_bulleted</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleOrderedList().run()"
          [class.is-active]="editor.isActive('orderedList')"
          >
          <div>format_list_numbered</div>
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().toggleBlockquote().run()"
          [class.is-active]="editor.isActive('blockquote')"
          >
          <div>format_quote</div>
        </button>
        <button type="button" (click)="imageInput.click()">
          <div>add_photo_alternate</div>
        </button>
        <button
          type="button"
        (click)="
          editor
            .chain()
            .focus()
            .insertTable({ rows: 3, cols: 3, withHeaderRow: true })
            .run()
        "
          >
          Insert Table
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().addColumnBefore().run()"
          >
          Add Column Before
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().addColumnAfter().run()"
          >
          Add Column After
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().deleteColumn().run()"
          >
          Delete Column
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().addRowBefore().run()"
          >
          Add Row Before
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().addRowAfter().run()"
          >
          Add Row After
        </button>
        <button type="button" (click)="editor.chain().focus().deleteRow().run()">
          Delete Row
        </button>
        <button
          type="button"
          (click)="editor.chain().focus().deleteTable().run()"
          >
          Delete Table
        </button>
        <!-- Component injection toolbar -->
        <div class="toolbar-separator"></div>
        <button
          type="button"
          (click)="showComponentSelector()"
          class="component-btn"
          title="Insert Component"
          >
          <div>extension</div>
          <span>Components</span>
        </button>
      </div>
    }
    <input
      type="file"
      #imageInput
      hidden
      (change)="onFileSelected($event)"
      accept="image/*"
      />
    <tiptap-editor
      [(ngModel)]="content"
      [ngModelOptions]="{ standalone: true }"
      class="tiptap-editor-styles"
      >
      <!-- Content projection container for injected components -->
      <div class="injected-components-container" #componentContainer></div>
    </tiptap-editor>

    <otui-button (action)="onPostSubmit()">Submit</otui-button>
  </form>
</otui-card>

<!-- Component injection selector -->
<lib-component-selector
  [isVisible]="isComponentSelectorVisible"
  [components]="registeredComponents"
  (componentSelected)="onComponentSelected($event)"
  (closed)="hideComponentSelector()"
></lib-component-selector>

<!-- Property editor -->
<lib-property-editor
  [isVisible]="isPropertyEditorVisible"
  [componentInstance]="selectedComponentInstance"
  [propertyDefinitions]="selectedComponentProperties"
  (propertiesUpdated)="onPropertiesUpdated($event)"
  (closed)="hidePropertyEditor()"
></lib-property-editor>

<!-- Context menu -->
@if (isContextMenuVisible) {
  <lib-context-menu
    [x]="contextMenuX"
    [y]="contextMenuY"
    [editor]="editor"
  ></lib-context-menu>
}
